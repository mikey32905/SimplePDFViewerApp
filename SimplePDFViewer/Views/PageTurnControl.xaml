<UserControl x:Class="SimplePDFViewer.Views.PageTurnControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SimplePDFViewer.Views"
             mc:Ignorable="d" >

    <UserControl.Resources>
        <!-- Page Turn Forward Animation -->
        <Storyboard x:Key="PageTurnForward">
            <DoubleAnimation Storyboard.TargetName="CurrentPageTransform"
                           Storyboard.TargetProperty="Angle"
                           From="0" To="-90"
                           Duration="0:0:0.3"
                           AccelerationRatio="0.3"
                           DecelerationRatio="0.3"/>
            <DoubleAnimation Storyboard.TargetName="NextPageTransform"
                           Storyboard.TargetProperty="Angle"
                           From="90" To="0"
                           Duration="0:0:0.3"
                           AccelerationRatio="0.3"
                           DecelerationRatio="0.3"/>
        </Storyboard>

        <!-- Page Turn Backward Animation -->
        <Storyboard x:Key="PageTurnBackward">
            <DoubleAnimation Storyboard.TargetName="CurrentPageTransform"
                           Storyboard.TargetProperty="Angle"
                           From="0" To="90"
                           Duration="0:0:0.3"
                           AccelerationRatio="0.3"
                           DecelerationRatio="0.3"/>
            <DoubleAnimation Storyboard.TargetName="PreviousPageTransform"
                           Storyboard.TargetProperty="Angle"
                           From="-90" To="0"
                           Duration="0:0:0.3"
                           AccelerationRatio="0.3"
                           DecelerationRatio="0.3"/>
        </Storyboard>
    </UserControl.Resources>

    <Grid>
        <Viewport3D>
            <Viewport3D.Camera>
                <PerspectiveCamera Position="0,0,4" LookDirection="0,0,-1" FieldOfView="45"/>
            </Viewport3D.Camera>

            <ModelVisual3D>
                <ModelVisual3D.Content>
                    <DirectionalLight Color="White" Direction="-1,-1,-3"/>
                </ModelVisual3D.Content>
            </ModelVisual3D>

            <!-- Previous Page (for backward animation) -->
            <Viewport2DVisual3D>
                <Viewport2DVisual3D.Geometry>
                    <MeshGeometry3D Positions="-1,1,0 -1,-1,0 1,-1,0 1,1,0"
                                   TextureCoordinates="0,0 0,1 1,1 1,0"
                                   TriangleIndices="0 1 2 0 2 3"/>
                </Viewport2DVisual3D.Geometry>
                <Viewport2DVisual3D.Material>
                    <DiffuseMaterial Viewport2DVisual3D.IsVisualHostMaterial="True">
                        <DiffuseMaterial.Brush>
                            <VisualBrush Visual="{Binding ElementName=PreviousPageImage}"/>
                        </DiffuseMaterial.Brush>
                    </DiffuseMaterial>
                </Viewport2DVisual3D.Material>
                <Viewport2DVisual3D.Transform>
                    <RotateTransform3D>
                        <RotateTransform3D.Rotation>
                            <AxisAngleRotation3D x:Name="PreviousPageTransform" 
                                               Axis="0,1,0" Angle="-90"/>
                        </RotateTransform3D.Rotation>
                    </RotateTransform3D>
                </Viewport2DVisual3D.Transform>
                <Image x:Name="PreviousPageImage" Stretch="Fill"/>
            </Viewport2DVisual3D>

            <!-- Current Page -->
            <Viewport2DVisual3D>
                <Viewport2DVisual3D.Geometry>
                    <MeshGeometry3D Positions="-1,1,0 -1,-1,0 1,-1,0 1,1,0"
                                   TextureCoordinates="0,0 0,1 1,1 1,0"
                                   TriangleIndices="0 1 2 0 2 3"/>
                </Viewport2DVisual3D.Geometry>
                <Viewport2DVisual3D.Material>
                    <DiffuseMaterial Viewport2DVisual3D.IsVisualHostMaterial="True">
                        <DiffuseMaterial.Brush>
                            <VisualBrush Visual="{Binding ElementName=CurrentPageImage}"/>
                        </DiffuseMaterial.Brush>
                    </DiffuseMaterial>
                </Viewport2DVisual3D.Material>
                <Viewport2DVisual3D.Transform>
                    <RotateTransform3D>
                        <RotateTransform3D.Rotation>
                            <AxisAngleRotation3D x:Name="CurrentPageTransform" 
                                               Axis="0,1,0" Angle="0"/>
                        </RotateTransform3D.Rotation>
                    </RotateTransform3D>
                </Viewport2DVisual3D.Transform>
                <Image x:Name="CurrentPageImage" Stretch="Fill"/>
            </Viewport2DVisual3D>

            <!-- Next Page (for forward animation) -->
            <Viewport2DVisual3D>
                <Viewport2DVisual3D.Geometry>
                    <MeshGeometry3D Positions="-1,1,0 -1,-1,0 1,-1,0 1,1,0"
                                   TextureCoordinates="0,0 0,1 1,1 1,0"
                                   TriangleIndices="0 1 2 0 2 3"/>
                </Viewport2DVisual3D.Geometry>
                <Viewport2DVisual3D.Material>
                    <DiffuseMaterial Viewport2DVisual3D.IsVisualHostMaterial="True">
                        <DiffuseMaterial.Brush>
                            <VisualBrush Visual="{Binding ElementName=NextPageImage}"/>
                        </DiffuseMaterial.Brush>
                    </DiffuseMaterial>
                </Viewport2DVisual3D.Material>
                <Viewport2DVisual3D.Transform>
                    <RotateTransform3D>
                        <RotateTransform3D.Rotation>
                            <AxisAngleRotation3D x:Name="NextPageTransform" 
                                               Axis="0,1,0" Angle="90"/>
                        </RotateTransform3D.Rotation>
                    </RotateTransform3D>
                </Viewport2DVisual3D.Transform>
                <Image x:Name="NextPageImage" Stretch="Fill"/>
            </Viewport2DVisual3D>
        </Viewport3D>
    </Grid>
</UserControl>
